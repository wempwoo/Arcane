# 探索シーン仕様書

## 概要

探索シーンは、プレイヤーがゲーム世界を進むための抽象化されたマップを提供します。マップは分岐するパスとノードで構成され、プレイヤーはどのパスを進むかを選択しながら冒険を進めていきます。

## マップ構造

### 基本構造

- **ノードベース** - マップは接続されたノードのネットワークとして表現
- **パス** - ノード間を結ぶ線で、プレイヤーの選択できる経路を示す
- **階層構造** - マップは下から上へと進む階層構造を持つ（下部がスタート、上部がゴール）
  - **レベル** - 縦方向の移動単位（開始ノードが0レベル、上に進むごとに1レベル増加）
  - **レーン** - 横方向の移動単位（左、中央、右の3レーン）
    - 各レベルには最小1ノード、最大3ノードが存在可能
    - 中央レーンには必ずノードが存在する
- **移動制限**
  - プレイヤーは常に上方向（レベルを増やす方向）にのみ進むことができる
  - 次のレベルへのパスは同じレーンか隣接するレーンにのみ接続可能
  - 終了ノード以外は必ず次のレベルの1つ以上のノードに接続する（行き止まり禁止）

### ノードタイプ

マップ上のノードは以下のタイプに分類されます：

1. **基本ノード** - 特に何も起こらないノード
2. **戦闘ノード** - 戦闘シーンに遷移するノード
   - 赤色で表示され、剣のアイコンが表示される
   - プレイヤーが到達すると戦闘シーンに遷移
   - 戦闘シーンをクリアすると探索シーンに戻る

### ノードタイプの生成規則

- マップ生成時、各ノードのタイプはランダムで決定される
- 以下の制約に従ってノードタイプを決定：
  - 開始ノードと終了ノードは常に基本ノード
  - 通常ノード生成時、一定確率で戦闘ノードとなる

### マップ生成

- **固定マップ** - 開発初期は固定パターンのマップを使用
- **将来の拡張** - 後に複数のマップパターンやプロシージャル生成を実装予定

### マップ表示

- 全体像をシンプルな2Dビューで表示
- 現在地から選択可能なパスとノードを強調表示
- 未到達のノードは薄暗く表示
- 既に訪れたノードはマーク付き

## プレイヤー操作

### 移動

- **ノード選択** - 次に進めるノードをタップ/クリックして選択
- **選択可能なノード** - 現在位置から直接パスで繋がっており、かつ上方向に位置するノードのみ選択可能
- **移動アニメーション** - プレイヤーキャラクターが選択したノードへ移動するアニメーション

## ビジュアル要素

### マップデザイン

- シンプルな2Dビューでノードとパスを表現
- ノードは円形で表示
- パスは線で表現
- 背景は単色またはシンプルなグラデーション

### UI要素

- 現在地を示すマーカー
- 選択可能なノードのハイライト
- 訪問済みノードのマーク
- 簡易的なプレイヤーステータス表示

## オーディオ要素

- 環境音楽（探索マップのテーマ曲）
- ノード選択時の効果音
- 移動アニメーション時の効果音

## 拡張予定の機能

将来的には以下のような拡張を予定しています（現段階では実装しません）：

- **多様なノードタイプ** - 戦闘、イベント、休息など様々なノードタイプの追加
- **ノードアイコン** - 各ノードタイプを識別するためのアイコン表示
- **ランダム生成** - より複雑なマップのランダム生成アルゴリズム
- **情報ツールチップ** - ノードにカーソルを合わせた際の追加情報表示
- **分岐の選択肢** - 進路選択による戦略的な要素の追加
- **視覚的なテーマ変化** - マップの進行に伴う環境テーマの変化

## 技術的な実装

### データ構造

- **ノード構造** - 各ノードは以下の情報を持つJSONオブジェクトとして定義
  - 位置情報（レベル、レーン）
  - 接続情報（接続先ノードのリスト）
  - ノードタイプ（基本/戦闘）
  - 訪問状態

### 描画と表示

- **パス描画** - SVGまたはCanvasを使用して動的にパスを描画
- **ノード表示**
  - 基本ノード: 灰色の円形
  - 戦闘ノード: 赤色の円形と剣アイコン
  - 選択可能なノード: 輝きエフェクト
  - 訪問済みノード: チェックマーク

### ゲームロジック

- **ノード選択ロジック** - 現在位置から直接接続されたノードのみを選択可能に
- **シーン遷移**
  - 戦闘ノード到達時に戦闘シーンへ遷移
  - 戦闘シーンクリア後に探索シーンへ戻る（ノードを訪問済みにマーク）
- **アニメーション** - 簡易的なトゥイーンアニメーションでプレイヤーの移動を表現

## 初期実装のマイルストーン

1. 基本的なノード構造とマップ表示の実装
2. ノード間の移動操作の実装
3. マップの進行状態の保存機能
4. 簡易的なUI要素の追加