# 戦闘シーン仕様書

## 概要

戦闘シーンは、探索シーンの戦闘ノードで発生する戦闘を管理するシーンです。2D縦スクロールシューティングのような形式で、プレイヤーユニットと敵ユニットが魔法による攻撃を行います。

## シーン構造

### 基本レイアウト

- **画面構成**
  - 下部：味方ユニット配置エリア
  - 上部：敵ユニット出現エリア
  - 中央：戦闘空間（魔法の発射や衝突判定が行われる領域）

### ユニット配置

- **味方ユニット**
  - 画面下部に固定位置で配置
  - 複数ユニットの配置に対応できる設計（初期は1体）

- **敵ユニット**
  - 画面上部に出現
  - 複数体の出現に対応できる設計（初期は1体）
  - 初期実装では固定位置に静止

## 戦闘システム

### 魔法攻撃システム

- **基本動作**
  - 味方ユニットは自動で魔法攻撃を実行
  - 一定間隔で魔法オブジェクトを発射
  - 魔法オブジェクトは直線的に上方向へ移動

- **攻撃判定**
  - 魔法オブジェクトと敵ユニットの衝突判定
  - 衝突時にダメージを与える
  - 魔法オブジェクトは衝突時に消滅

### ダメージシステム

- **HP管理**
  - 各ユニットはHPを持つ
  - HPが0になると撃破
  - HPはゲージで可視化

### 戦闘の進行

- **開始条件**
  - 探索シーンの戦闘ノードに到達時に開始
  - シーン開始時に敵ユニットを配置

- **勝利条件**
  - すべての敵ユニットの撃破
  - 勝利時は探索シーンに戻る（戦闘ノードを訪問済みにマーク）

## ビジュアル要素

### ユニット表現

- **味方ユニット**
  - キャラクターグラフィック
  - HPゲージ
  - 魔法発動時のエフェクト

- **敵ユニット**
  - キャラクターグラフィック
  - HPゲージ
  - 被ダメージ時のエフェクト

### 魔法エフェクト

- **魔法オブジェクト**
  - 発射時のエフェクト
  - 移動中のアニメーション
  - 衝突時の消滅エフェクト

## オーディオ要素

- 戦闘BGM
- 魔法発射音
- 衝突・ダメージ音
- 撃破音
- 勝利ジングル

## 技術的な実装

### コンポーネント構造

- **BattleScene**
  - シーン全体の管理
  - 戦闘の進行状態管理
  - シーン遷移の制御

- **UnitManager**
  - ユニットの生成・管理
  - HP管理
  - 位置管理

- **MagicSystem**
  - 魔法オブジェクトの生成・管理
  - 発射タイミングの制御
  - 衝突判定の処理

## 初期実装のマイルストーン

1. **基本システムの実装**
   - シーン遷移の実装
   - ユニット配置の実装
   - 基本的な描画システム

2. **戦闘システムの実装**
   - 魔法発射システム
   - 衝突判定システム
   - HPシステム

3. **視覚・聴覚効果の実装**
   - 基本的なアニメーション
   - 効果音の実装

4. **戦闘終了処理の実装**
   - 勝利判定
   - 探索シーンへの遷移

## 将来の拡張予定

- 複数の魔法タイプ
- 敵ユニットの移動パターン
- 複数の敵ユニット配置パターン
- ボス戦の実装
- 特殊な戦闘ギミック