# 魔法システム仕様書

## 概要

戦闘シーンにおける魔法システムは、「魔導機」「魔導回路」「宝珠」の3つの主要コンポーネントから構成される複雑なシステムです。
これらの要素が組み合わさることで、多様な戦術的選択肢を生み出します。

## 魔導機（ArcMachine）

魔導機は戦闘シーンにおける実際の戦闘ユニットです。

### 性能要素

- **HP（ヒットポイント）**
  - ユニットの耐久値
  - 0になると撃破される

- **マナ容量**
  - 魔導機が蓄積できるマナの最大量
  - 戦闘開始時は満タンの状態でスタート
  - 大きいほど、初動での連続魔法発動が可能
  - 個々の宝珠の消費マナ量がこの値を超える場合、その宝珠は使用不可

- **マナ生成力**
  - 単位時間あたりのマナ生成量
  - 常時一定速度でマナを生成し続ける
  - 生成されたマナは自動的に蓄積される（マナ容量が上限）
  - 高いほど、持続的な魔法発動が可能

## 魔導回路（ArcCircuit）

魔導機に搭載される魔法発動のための回路システムです。探索中に新しい回路を入手することで、より多様な戦術が可能になります。

### 基本構造

- **宝珠スロット**
  - 宝珠を装着するための接続口
  - 回路ごとに数と配置が異なる

- **回路形状**
  - スロット同士を接続する回路の形状
  - 宝珠の起動順序を決定
  - 回路ごとに特徴的な形状を持つ
  - 分岐の有無や接続パターンが戦術に影響

### 回路の特徴

- **基本原則**
  - 開始地点は必ず1つ
  - 魔力は一方向にのみ伝達
  - 分岐は許容され、並列処理される
  - マナは常時生成され、容量上限まで蓄積される

- **回路の入手**
  - 探索中に新しい回路を発見可能
  - 回路の形状はランダムに生成される
  - 発見時に回路の構造が決定

### 動作メカニズム

- **回路の進行**
  1. 開始地点の宝珠から順に処理を開始
  2. 各宝珠に到達したとき：
     - 必要マナが蓄積されているか確認
       - 不足している場合：マナが充填されるまで待機
     - 発動時間分の待機
     - 魔法を発動し、マナを消費
  3. 回路に沿って次の宝珠へ進む
     - 分岐点では、各経路を並列で処理
     - 各宝珠は他の宝珠の状態に影響されず独立して処理
  4. 最後の宝珠まで到達したら開始地点に戻る
  5. この過程を継続的に実行

- **回路の分岐**
    - 分岐後は並列で宝珠が起動
    - 特徴：
      - 低コストの宝珠を組み合わせて同時発動
      - 範囲攻撃と単体攻撃の組み合わせなどに有効
      - より高度な戦術を可能にする

- **戦術的考慮点**
  - マナ容量は戦闘開始時の連続発動能力に影響
  - マナ生成力は持続的な魔法発動能力を決定
  - 発動時間の異なる宝珠の配置順序が重要

### 性能要素

- **魔力伝達速度**
  - 宝珠から宝珠へと魔力が伝わる速度
  - 各宝珠の起動間隔を決定する要素

## 宝珠

魔法の本体となる結晶体です。

### 特徴

- 1つの宝珠に1種類の魔法が込められている
- 様々な種類の魔法が存在する
- 宝珠ごとに以下の性能要素を持つ：
  - **消費マナ量**
    - 魔法発動に必要なマナ量
    - 魔導機のマナ容量を超えると使用不可
  - **発動時間**
    - 魔法の発動に必要な時間（ミリ秒単位）
    - 回路がその宝珠に到達したとき、発動時間分の待機が必要
  - **威力**
    - 魔法攻撃の基本的な強さを表す
    - 相対的な数値として扱う
  - **射程**
    - 魔法の有効射程距離
    - 短射程で高威力など、特徴的な組み合わせが可能

- **基準となる宝珠「マナの矢」**
  - 最も基本的な攻撃魔法
  - 性能値：
    - 消費マナ: 5（基準値）
    - 発動時間: 300ms
    - 威力: 100（基準値）
    - 射程: 1000（基準値）

- **標準的な魔導機の性能値**
  - マナ容量: 100
    - マナの矢20回分相当
    - 戦闘開始時はこの値まで充填された状態
  - マナ生成力: 5/秒
    - マナの矢を1秒に1回のペースで撃ち続けられる程度
    - より強力な魔法を使用する場合は、マナの充填を待つ必要がある

### 宝珠の管理

- 魔導回路のスロットに装着して使用
- 回路上の位置は発動順序を決定
- 各宝珠は独立して処理される
  - 後続の宝珠の状態が前の宝珠の動作に影響することはない
  - 発動時間や必要マナは、その宝珠が起動するタイミングでのみ考慮される

## 戦術的考慮点

1. **魔導機の選択**
   - マナ容量と生成力のバランスを考慮
   - 搭載する魔導回路との相性

2. **魔導回路の選択**
   - 必要なスロット数の確保
   - 効果的な起動順序の設計
   - 魔力伝達速度の考慮

3. **宝珠の配置と戦術例**
   - 消費マナ量の総和が魔導機の許容量以内に収まるよう調整
   - 効果的な起動順序を考慮した配置
   
   例1：**初動の爆発力を重視**
   - 戦闘開始時のマナ100を活用
   - マナの矢（消費マナ5）を20回連続発動
   - 6秒間で合計2000の威力を出力可能
   
   例2：**持続的な攻撃**
   - マナ生成力5/秒を活用
   - マナの矢を1秒に1回のペースで継続的に発動
   - 安定した100威力/秒のダメージを維持
   
   例3：**強力魔法との組み合わせ**
   - 消費マナ25の強力な魔法と組み合わせ
   - 強力魔法の発動後、マナ回復中はマナの矢で攻撃
   - 5秒かけてマナを回復しつつ基本攻撃を継続

## 実装上の注意点

1. **マナ管理システム**
   - リアルタイムでのマナ消費と回復の計算
   - 許容量チェックの実装

2. **魔導回路システム**
   - 回路形状の定義と視覚化
   - 宝珠の起動順序の制御
   - 魔力伝達の表現

3. **宝珠システム**
   - 多様な魔法効果の実装
   - 装着・取り外しの処理
   - 魔法効果の視覚化

## 拡張性

将来的な拡張要素として以下を考慮：

1. **新しい魔導回路パターン**
   - より複雑な形状
   - 特殊な起動条件

2. **特殊な宝珠**
   - 複数の魔法を内包
   - 条件付きの効果発動

3. **魔導機の特殊能力**
   - 特定の魔法との相性
   - ユニークなマナ管理システム